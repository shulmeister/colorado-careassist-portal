{
  "tools": [
    {
      "type": "function",
      "function": {
        "name": "verify_caller",
        "description": "ALWAYS call this FIRST when a call starts. Identifies whether the caller is a 'caregiver', 'client', or 'unknown' by looking up their phone number in WellSky. The result determines which conversation path to follow.",
        "parameters": {
          "type": "object",
          "properties": {
            "phone_number": {
              "type": "string",
              "description": "The caller's phone number. Use the from_number provided by Retell at call start."
            }
          },
          "required": ["phone_number"]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "get_active_shifts",
        "description": "Gets all shifts for a caregiver in the next 24 hours. Returns a list with shift_id, client_name, and start_time for each shift. Use this after verify_caller to see the caregiver's upcoming schedule.",
        "parameters": {
          "type": "object",
          "properties": {
            "person_id": {
              "type": "string",
              "description": "The caregiver's ID returned from verify_caller."
            }
          },
          "required": ["person_id"]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "get_shift_details",
        "description": "Gets detailed information about the caregiver's next scheduled shift including client name, address, and times.",
        "parameters": {
          "type": "object",
          "properties": {
            "person_id": {
              "type": "string",
              "description": "The caregiver's ID returned from verify_caller."
            }
          },
          "required": ["person_id"]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "execute_caregiver_call_out",
        "description": "CALL ONCE for caregiver call-outs. After success, confirm with caller and STOP - do NOT call again. This tool updates WellSky, logs the call-out, and triggers replacement SMS all in one call. If shift is less than 2 hours away, requires_manual_handoff=true means transfer to manager.",
        "parameters": {
          "type": "object",
          "properties": {
            "caregiver_id": {
              "type": "string",
              "description": "The caregiver's ID from verify_caller"
            },
            "shift_id": {
              "type": "string",
              "description": "The shift ID from get_active_shifts or get_shift_details"
            },
            "reason": {
              "type": "string",
              "enum": ["sick", "emergency", "car_trouble", "family", "other"],
              "description": "Reason for call-out. Default to 'sick' if caller says they're ill."
            }
          },
          "required": ["caregiver_id", "shift_id"]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "report_call_out",
        "description": "CALL ONCE to report a caregiver call-out. After success, say 'Got it, we're finding coverage' and STOP. Do NOT call this tool again - one call handles everything. The system automatically finds replacements and sends SMS blasts.",
        "parameters": {
          "type": "object",
          "properties": {
            "caregiver_id": {
              "type": "string",
              "description": "The caregiver's ID from verify_caller."
            },
            "shift_id": {
              "type": "string",
              "description": "The shift ID from get_shift_details."
            },
            "reason": {
              "type": "string",
              "description": "The reason for the call-out (sick, emergency, car_trouble, family, other)."
            }
          },
          "required": ["caregiver_id", "shift_id", "reason"]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "find_replacement_caregivers",
        "description": "Find available caregivers who can cover an open shift. Returns candidates ranked by compatibility (prior relationship with client, distance, availability). Use this to see who's available before starting outreach.",
        "parameters": {
          "type": "object",
          "properties": {
            "shift_id": {
              "type": "string",
              "description": "The shift ID that needs coverage."
            },
            "max_results": {
              "type": "integer",
              "description": "Maximum number of candidates to return. Default 10."
            }
          },
          "required": ["shift_id"]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "start_shift_filling_campaign",
        "description": "Start an automated campaign to fill an open shift. Contacts multiple caregivers simultaneously via SMS. Returns campaign_id and number of caregivers contacted.",
        "parameters": {
          "type": "object",
          "properties": {
            "shift_id": {
              "type": "string",
              "description": "The shift that needs to be filled."
            },
            "caregiver_id": {
              "type": "string",
              "description": "The caregiver who called out."
            },
            "reason": {
              "type": "string",
              "description": "Reason for the call-out."
            }
          },
          "required": ["shift_id", "caregiver_id", "reason"]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "get_shift_filling_status",
        "description": "Check the status of an active shift filling campaign. Returns how many caregivers have been contacted and if anyone has accepted.",
        "parameters": {
          "type": "object",
          "properties": {
            "campaign_id": {
              "type": "string",
              "description": "The campaign ID from start_shift_filling_campaign or report_call_out."
            }
          },
          "required": ["campaign_id"]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "log_client_issue",
        "description": "Logs a client service issue to the portal. CALL THIS ONLY ONCE PER ISSUE - the system captures everything from one call. After it returns success, say 'I've logged this' and move to closing. Do NOT call this tool again to add more details.",
        "parameters": {
          "type": "object",
          "properties": {
            "client_id": {
              "type": "string",
              "description": "The client's ID from verify_caller. Use null for unknown callers."
            },
            "note": {
              "type": "string",
              "description": "Description of the issue or request."
            },
            "issue_type": {
              "type": "string",
              "enum": ["general", "complaint", "schedule", "feedback", "emergency"],
              "description": "Type of issue."
            },
            "priority": {
              "type": "string",
              "enum": ["low", "normal", "high", "urgent"],
              "description": "Priority level. Use 'urgent' for safety concerns."
            }
          },
          "required": ["note"]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "get_client_schedule",
        "description": "Get upcoming visits for a client. Use when a CLIENT asks 'When is my caregiver coming?' Returns next 7 days of scheduled visits. CALL ONCE, then tell them their schedule.",
        "parameters": {
          "type": "object",
          "properties": {
            "client_id": {
              "type": "string",
              "description": "The client's ID from verify_caller."
            },
            "days_ahead": {
              "type": "integer",
              "description": "Number of days to look ahead. Default 7."
            }
          },
          "required": ["client_id"]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "report_late",
        "description": "Report that a caregiver is running late and notify the client. Use when a CAREGIVER says 'I'm running late' or 'I'll be late'. CALL ONCE, then confirm 'Got it, I've notified the client.'",
        "parameters": {
          "type": "object",
          "properties": {
            "shift_id": {
              "type": "string",
              "description": "The shift ID from get_shift_details."
            },
            "delay_minutes": {
              "type": "integer",
              "description": "Estimated minutes late (e.g., 15, 30)."
            },
            "reason": {
              "type": "string",
              "description": "Optional reason (traffic, car trouble, etc.)."
            }
          },
          "required": ["shift_id", "delay_minutes"]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "cancel_client_visit",
        "description": "Cancel a scheduled visit. Use when a CLIENT or FAMILY MEMBER says they need to cancel. CALL ONCE, then confirm 'I've cancelled that visit.'",
        "parameters": {
          "type": "object",
          "properties": {
            "shift_id": {
              "type": "string",
              "description": "The shift ID to cancel (get from get_client_schedule or ask for date/time)."
            },
            "reason": {
              "type": "string",
              "description": "Reason for cancellation."
            },
            "cancelled_by": {
              "type": "string",
              "enum": ["client", "family"],
              "description": "Who requested the cancellation."
            }
          },
          "required": ["shift_id", "reason"]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "add_note_to_wellsky",
        "description": "Add a note to a client or caregiver profile in WellSky. Use at the END of important calls to document what was discussed and any actions taken. CALL ONCE per call.",
        "parameters": {
          "type": "object",
          "properties": {
            "person_type": {
              "type": "string",
              "enum": ["client", "caregiver"],
              "description": "Whether this is a client or caregiver profile."
            },
            "person_id": {
              "type": "string",
              "description": "The person's ID from verify_caller."
            },
            "note": {
              "type": "string",
              "description": "Summary of the call and any actions taken."
            },
            "note_type": {
              "type": "string",
              "enum": ["general", "call", "complaint", "callout", "late", "schedule"],
              "description": "Type of note."
            }
          },
          "required": ["person_type", "person_id", "note"]
        }
      }
    }
  ],
  "webhook_url": "https://portal.coloradocareassist.com/gigi/webhook/retell",
  "timeout_ms": 30000,
  "system_prompt": "You are Gigi, the after-hours AI assistant for Colorado Care Assist, a non-medical home care agency in Colorado.\n\nYOU ARE AN ACTIVE AGENT - You don't just take messages, you GET TO WORK finding coverage!\n\nCALL FLOW:\n1. FIRST: Call verify_caller with the caller's phone number to identify them.\n2. IF CAREGIVER calling out:\n   - Call get_active_shifts to see their upcoming shifts\n   - Confirm which shift and why (sick, emergency, etc.)\n   - Call execute_caregiver_call_out OR report_call_out with caregiver_id, shift_id, and reason\n   - THE SYSTEM WILL AUTOMATICALLY:\n     * Update WellSky to mark the shift as open\n     * Find qualified replacement caregivers\n     * Start SMS outreach to available caregivers\n     * Notify the on-call manager as backup\n   - CHECK THE RESPONSE and tell them:\n     * 'I'm already reaching out to [X] available caregivers to find coverage for your shift.'\n     * 'You don't need to do anything else - I'll handle finding coverage.'\n     * If requires_manual_handoff=true: Say the message from the response (about connecting to on-call manager)\n3. IF CLIENT with issue:\n   - Listen to their concern\n   - Call log_client_issue with details\n   - Assure them the care team will follow up during business hours\n\nSAFETY RULES:\n- Call-outs only work for shifts starting within 24 hours\n- If shift starts in less than 2 hours, manual handoff is required\n\nTONE: Warm, empathetic, professional. Confident about finding coverage - you're actively working on it!\n\nHOURS: You handle after-hours calls (evenings after 5pm, weekends, holidays). Business hours are Mon-Fri 8am-5pm MT."
}
