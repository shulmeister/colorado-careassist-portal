{
  "tools": [
    {
      "type": "function",
      "function": {
        "name": "verify_caller",
        "description": "ALWAYS call this FIRST when a call starts. Identifies whether the caller is a 'caregiver', 'client', or 'unknown' by looking up their phone number in WellSky. The result determines which conversation path to follow.",
        "parameters": {
          "type": "object",
          "properties": {
            "phone_number": {
              "type": "string",
              "description": "The caller's phone number. Use the from_number provided by Retell at call start."
            }
          },
          "required": ["phone_number"]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "get_weather",
        "description": "Get current weather conditions for a location. Use when caller asks about weather, snow conditions, or driving conditions. Supports Boulder, Denver, ski areas (Eldora, Vail, Breckenridge, Keystone, A-Basin, Loveland, Copper, Winter Park).",
        "parameters": {
          "type": "object",
          "properties": {
            "location": {
              "type": "string",
              "description": "Location name (e.g., 'Boulder', 'Eldora', 'Denver'). Defaults to Boulder if not specified."
            }
          },
          "required": []
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "transfer_to_jason",
        "description": "Transfer the call to Jason Shulman. Use ONLY for: 1) Known contacts calling Jason 2) Important urgent matters requiring owner attention. Do NOT use for routine business calls - handle those yourself.",
        "parameters": {
          "type": "object",
          "properties": {
            "reason": {
              "type": "string",
              "description": "Brief reason for transfer (e.g., 'Personal call from known contact', 'Urgent business matter')"
            }
          },
          "required": ["reason"]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "take_message",
        "description": "Take a message from an unknown caller who wants to speak with Jason. Records their message and sends it to Jason via Telegram. Use when caller is NOT in contacts database and wants to leave a message.",
        "parameters": {
          "type": "object",
          "properties": {
            "caller_phone": {
              "type": "string",
              "description": "Caller's phone number"
            },
            "caller_name": {
              "type": "string",
              "description": "Caller's name if they provided it"
            },
            "message": {
              "type": "string",
              "description": "The message content from the caller"
            }
          },
          "required": ["caller_phone", "message"]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "get_active_shifts",
        "description": "Gets all shifts for a caregiver in the next 24 hours. Returns a list with shift_id, client_name, and start_time for each shift. Use this after verify_caller to see the caregiver's upcoming schedule.",
        "parameters": {
          "type": "object",
          "properties": {
            "person_id": {
              "type": "string",
              "description": "The caregiver's ID returned from verify_caller."
            }
          },
          "required": ["person_id"]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "get_shift_details",
        "description": "Gets detailed information about the caregiver's next scheduled shift including client name, address, and times.",
        "parameters": {
          "type": "object",
          "properties": {
            "person_id": {
              "type": "string",
              "description": "The caregiver's ID returned from verify_caller."
            }
          },
          "required": ["person_id"]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "execute_caregiver_call_out",
        "description": "CALL ONCE for caregiver call-outs. After success, confirm with caller and STOP - do NOT call again. This tool updates WellSky, logs the call-out, and triggers replacement SMS all in one call. If shift is less than 2 hours away, requires_manual_handoff=true means transfer to manager.",
        "parameters": {
          "type": "object",
          "properties": {
            "caregiver_id": {
              "type": "string",
              "description": "The caregiver's ID from verify_caller"
            },
            "shift_id": {
              "type": "string",
              "description": "The shift ID from get_active_shifts or get_shift_details"
            },
            "reason": {
              "type": "string",
              "enum": ["sick", "emergency", "car_trouble", "family", "other"],
              "description": "Reason for call-out. Default to 'sick' if caller says they're ill."
            }
          },
          "required": ["caregiver_id", "shift_id"]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "cancel_shift_acceptance",
        "description": "Cancel a shift that caregiver previously accepted. Use when caregiver says 'I accepted earlier but can't make it' or 'I need to cancel the shift I took'. CALL ONCE - after success, confirm cancellation and STOP. This unassigns them, restarts replacement search, and notifies manager.",
        "parameters": {
          "type": "object",
          "properties": {
            "caregiver_id": {
              "type": "string",
              "description": "The caregiver's ID from verify_caller"
            },
            "shift_id": {
              "type": "string",
              "description": "The shift ID they want to cancel"
            },
            "reason": {
              "type": "string",
              "description": "Why they're cancelling (e.g., 'changed mind', 'conflict', 'emergency', 'other plans'). Ask if not provided."
            }
          },
          "required": ["caregiver_id", "shift_id"]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "report_call_out",
        "description": "CALL ONCE to report a caregiver call-out. After success, say 'Got it, we're finding coverage' and STOP. Do NOT call this tool again - one call handles everything. The system automatically finds replacements and sends SMS blasts.",
        "parameters": {
          "type": "object",
          "properties": {
            "caregiver_id": {
              "type": "string",
              "description": "The caregiver's ID from verify_caller."
            },
            "shift_id": {
              "type": "string",
              "description": "The shift ID from get_shift_details."
            },
            "reason": {
              "type": "string",
              "description": "The reason for the call-out (sick, emergency, car_trouble, family, other)."
            }
          },
          "required": ["caregiver_id", "shift_id", "reason"]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "find_replacement_caregivers",
        "description": "Find available caregivers who can cover an open shift. Returns candidates ranked by compatibility (prior relationship with client, distance, availability). Use this to see who's available before starting outreach.",
        "parameters": {
          "type": "object",
          "properties": {
            "shift_id": {
              "type": "string",
              "description": "The shift ID that needs coverage."
            },
            "max_results": {
              "type": "integer",
              "description": "Maximum number of candidates to return. Default 10."
            }
          },
          "required": ["shift_id"]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "start_shift_filling_campaign",
        "description": "Start an automated campaign to fill an open shift. Contacts multiple caregivers simultaneously via SMS. Returns campaign_id and number of caregivers contacted.",
        "parameters": {
          "type": "object",
          "properties": {
            "shift_id": {
              "type": "string",
              "description": "The shift that needs to be filled."
            },
            "caregiver_id": {
              "type": "string",
              "description": "The caregiver who called out."
            },
            "reason": {
              "type": "string",
              "description": "Reason for the call-out."
            }
          },
          "required": ["shift_id", "caregiver_id", "reason"]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "get_shift_filling_status",
        "description": "Check the status of an active shift filling campaign. Returns how many caregivers have been contacted and if anyone has accepted.",
        "parameters": {
          "type": "object",
          "properties": {
            "campaign_id": {
              "type": "string",
              "description": "The campaign ID from start_shift_filling_campaign or report_call_out."
            }
          },
          "required": ["campaign_id"]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "log_client_issue",
        "description": "Logs a client service issue to the portal. CALL THIS ONLY ONCE PER ISSUE - the system captures everything from one call. After it returns success, say 'I've logged this' and move to closing. Do NOT call this tool again to add more details.",
        "parameters": {
          "type": "object",
          "properties": {
            "client_id": {
              "type": "string",
              "description": "The client's ID from verify_caller. Use null for unknown callers."
            },
            "note": {
              "type": "string",
              "description": "Description of the issue or request."
            },
            "issue_type": {
              "type": "string",
              "enum": ["general", "complaint", "schedule", "feedback", "emergency"],
              "description": "Type of issue."
            },
            "priority": {
              "type": "string",
              "enum": ["low", "normal", "high", "urgent"],
              "description": "Priority level. Use 'urgent' for safety concerns."
            }
          },
          "required": ["note"]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "get_client_schedule",
        "description": "Get upcoming visits for a client. Use when a CLIENT asks 'When is my caregiver coming?' Returns next 7 days of scheduled visits. CALL ONCE, then tell them their schedule.",
        "parameters": {
          "type": "object",
          "properties": {
            "client_id": {
              "type": "string",
              "description": "The client's ID from verify_caller."
            },
            "days_ahead": {
              "type": "integer",
              "description": "Number of days to look ahead. Default 7."
            }
          },
          "required": ["client_id"]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "report_late",
        "description": "Report that a caregiver is running late and notify the client. Use when a CAREGIVER says 'I'm running late' or 'I'll be late'. CALL ONCE, then confirm 'Got it, I've notified the client.'",
        "parameters": {
          "type": "object",
          "properties": {
            "shift_id": {
              "type": "string",
              "description": "The shift ID from get_shift_details."
            },
            "delay_minutes": {
              "type": "integer",
              "description": "Estimated minutes late (e.g., 15, 30)."
            },
            "reason": {
              "type": "string",
              "description": "Optional reason (traffic, car trouble, etc.)."
            }
          },
          "required": ["shift_id", "delay_minutes"]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "cancel_client_visit",
        "description": "Cancel a scheduled visit. Use when a CLIENT or FAMILY MEMBER says they need to cancel. CALL ONCE, then confirm 'I've cancelled that visit.'",
        "parameters": {
          "type": "object",
          "properties": {
            "shift_id": {
              "type": "string",
              "description": "The shift ID to cancel (get from get_client_schedule or ask for date/time)."
            },
            "reason": {
              "type": "string",
              "description": "Reason for cancellation."
            },
            "cancelled_by": {
              "type": "string",
              "enum": ["client", "family"],
              "description": "Who requested the cancellation."
            }
          },
          "required": ["shift_id", "reason"]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "add_note_to_wellsky",
        "description": "Add a note to a client or caregiver profile in WellSky. Use at the END of important calls to document what was discussed and any actions taken. CALL ONCE per call.",
        "parameters": {
          "type": "object",
          "properties": {
            "person_type": {
              "type": "string",
              "enum": ["client", "caregiver"],
              "description": "Whether this is a client or caregiver profile."
            },
            "person_id": {
              "type": "string",
              "description": "The person's ID from verify_caller."
            },
            "note": {
              "type": "string",
              "description": "Summary of the call and any actions taken."
            },
            "note_type": {
              "type": "string",
              "enum": ["general", "call", "complaint", "callout", "late", "schedule"],
              "description": "Type of note."
            }
          },
          "required": ["person_type", "person_id", "note"]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "gmail_search",
        "description": "Search Jason's Gmail for specific information. Use when Jason or a known contact asks 'Gigi, did I get an email about X?' or 'Gigi, find the latest invoice from Y'.",
        "parameters": {
          "type": "object",
          "properties": {
            "query": {
              "type": "string",
              "description": "The Gmail search query (e.g., 'from:someone@example.com', 'is:unread', 'invoice')."
            },
            "limit": {
              "type": "integer",
              "description": "Maximum results to return. Default 5."
            }
          },
          "required": ["query"]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "get_calendar_events",
        "description": "Check Jason's calendar for upcoming appointments. Use when Jason or a known contact asks 'What's my schedule today?' or 'When is my meeting with X?'.",
        "parameters": {
          "type": "object",
          "properties": {
            "days": {
              "type": "integer",
              "description": "Number of days to look ahead. Default 1 (today)."
            },
            "limit": {
              "type": "integer",
              "description": "Maximum number of events to return. Default 10."
            }
          }
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "search_concerts",
        "description": "Search upcoming concerts for Jason's favorite artists (Phish, Goose, Billy Strings, etc). Use when Jason asks 'Who is playing?' or 'Any upcoming shows?'.",
        "parameters": {
          "type": "object",
          "properties": {
            "query": {
              "type": "string",
              "description": "Optional search term (e.g., 'Red Rocks', 'Phish')."
            }
          }
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "buy_tickets",
        "description": "Initiate a ticket purchase. Gigi will send a 2FA confirmation text to Jason's phone. Use when Jason says 'Buy 2 tickets for X'. ALWAYS wait for session_id then ask for confirmation.",
        "parameters": {
          "type": "object",
          "properties": {
            "artist": { "type": "string" },
            "venue": { "type": "string" },
            "quantity": { "type": "integer", "default": 2 }
          },
          "required": ["artist", "venue"]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "book_table",
        "description": "Book a restaurant reservation. Gigi will send a 2FA confirmation text to Jason's phone. Use when Jason asks to book a table.",
        "parameters": {
          "type": "object",
          "properties": {
            "restaurant": { "type": "string" },
            "party_size": { "type": "integer", "default": 2 },
            "date": { "type": "string", "description": "e.g., 'Friday' or '2026-02-13'" },
            "time": { "type": "string", "description": "e.g., '7:30 PM'" }
          },
          "required": ["restaurant", "time"]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "confirm_chief_action",
        "description": "Finalize a purchase or reservation AFTER the user confirms on the call and says they received the text. ONLY call this after buy_tickets or book_table.",
        "parameters": {
          "type": "object",
          "properties": {
            "session_id": { "type": "string", "description": "The session ID returned by the initial request tool." }
          },
          "required": ["session_id"]
        }
      }
    }
  ],
  "webhook_url": "https://portal.coloradocareassist.com/gigi/webhook/retell",
  "timeout_ms": 30000,
  "system_prompt": "You are Gigi, an AI assistant for Jason Shulman and Colorado Care Assist.\n\nELITE CHIEF OF STAFF MODE:\n- You help Jason with his schedule, email, and personal requests.\n- When buying tickets or booking tables, you use a 2FA flow: \n  1. Call the request tool (buy_tickets/book_table).\n  2. Inform Jason: 'I've initiated that and sent a confirmation text to your phone for security.'\n  3. Wait for him to say 'Yes' or 'Go ahead'.\n  4. Call confirm_chief_action to finalize.\n\nCALLER ID & GREETING FLOW:\n1. The system automatically identifies callers before you speak\n2. If caller is JASON or a KNOWN CONTACT:\n   - Greet them by name: 'Hi [Name]!'\n   - Ask how you can help\n   - You can search their GMAIL, check CALENDAR, search CONCERTS, or make PURCHASES.\n   - If they want Jason, call transfer_to_jason\n3. If caller is UNKNOWN:\n   - Greet professionally: 'Hi! This is Gigi, Jason's assistant.'\n   - Offer to take a message using take_message tool\n\nFOR COLORADO CARE ASSIST BUSINESS:\n- CAREGIVERS calling out: Use verify_caller, get_active_shifts, execute_caregiver_call_out\n- CLIENTS with issues: Use verify_caller, log_client_issue\n\nTONE: Warm, professional, highly efficient. You are Jason's Elite Chief of Staff."
}
